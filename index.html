<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CX åŠ å¯†å·¥å…·ç®±2.0ç‰ˆ</title>
<style>
:root{--p:#00f2ff;--s:#0078ff;--a:#00ff88;--bg:#0f172a;--c:rgba(30,41,59,0.75);--b:rgba(255,255,255,0.15);--t:#e2e8f0;--ts:#94a3b8;--fm:'Courier New',monospace;--fu:-apple-system,sans-serif}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;padding:15px;background:var(--bg);background-image:radial-gradient(circle at 15% 50%,rgba(0,242,255,0.08),transparent 25%),radial-gradient(circle at 85% 30%,rgba(0,120,255,0.08),transparent 25%);color:var(--t);font-family:var(--fu);min-height:100vh;display:flex;flex-direction:column;align-items:center}
body::before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(var(--b) 1px,transparent 1px),linear-gradient(90deg,var(--b) 1px,transparent 1px);background-size:40px 40px;opacity:.1;z-index:-1;pointer-events:none}
.box{width:100%;max-width:1200px;padding-bottom:60px}
h1{text-align:center;font-size:1.5rem;margin:10px 0 20px;background:linear-gradient(90deg,var(--p),var(--s));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;letter-spacing:2px;border-bottom:1px solid var(--b);padding-bottom:15px}
.nav{display:flex;gap:10px;margin-bottom:20px;justify-content:center}
.nb{background:rgba(0,0,0,.3);color:var(--ts);border:1px solid var(--b);padding:12px 25px;font-size:1rem;font-weight:600;cursor:pointer;border-radius:8px;transition:.3s;min-width:120px}
.nb.on{background:rgba(0,242,255,.15);color:var(--p);border-color:var(--p);box-shadow:0 0 15px rgba(0,242,255,.15)}
.mod{display:none;animation:F .4s ease}.mod.on{display:block}
.card{background:var(--c);backdrop-filter:blur(12px);border:1px solid var(--b);border-radius:12px;padding:20px;margin-bottom:15px;box-shadow:0 4px 20px rgba(0,0,0,.3)}
.ht{color:var(--p);font-weight:700;font-size:1rem;margin-bottom:15px;border-bottom:1px solid var(--b);padding-bottom:8px;display:flex;justify-content:space-between}
details{background:rgba(0,0,0,.2);border-radius:8px;border:1px dashed var(--ts);margin-bottom:20px;overflow:hidden}
summary{padding:10px 15px;cursor:pointer;color:var(--a);font-weight:700;font-size:.9rem;user-select:none;transition:.2s}
summary:hover{background:rgba(255,255,255,.05)}
.mc{padding:15px;font-size:.85rem;color:var(--ts);line-height:1.6;border-top:1px solid var(--b)}
.mc p{margin:5px 0}.tag{display:inline-block;padding:2px 6px;border-radius:4px;font-size:.75rem;font-weight:700;margin-right:5px}.t1{background:#ef4444;color:#fff}.t2{background:#3b82f6;color:#fff}
label{display:block;font-size:.85rem;color:var(--ts);margin:12px 0 6px}
input[type=text],input[type=password],textarea,select{width:100%;background:rgba(0,0,0,.3);border:1px solid var(--b);border-radius:6px;padding:12px;color:#fff;font-family:var(--fm);font-size:.9rem;outline:0;transition:.3s}
input:focus,textarea:focus,select:focus{border-color:var(--s);box-shadow:0 0 8px rgba(0,120,255,.3)}
textarea{min-height:80px;resize:vertical}
.btn{width:100%;border:none;border-radius:6px;padding:14px;font-weight:600;cursor:pointer;margin-top:15px;background:linear-gradient(135deg,var(--s),#0047ab);color:#fff;text-transform:uppercase;letter-spacing:1px;transition:.2s}
.btn:active{transform:scale(.98)}
.cp{background:rgba(0,242,255,.1);color:var(--p);padding:8px;font-size:.8rem;width:100%;margin-top:8px;border:1px solid rgba(0,242,255,.2);cursor:pointer;border-radius:4px}
.spl{display:flex;flex-direction:column;gap:20px}
.mtb{display:flex;gap:10px;margin-bottom:10px}
.mt{flex:1;padding:10px;text-align:center;background:rgba(0,0,0,.3);border-radius:6px;color:var(--ts);cursor:pointer;border:1px solid transparent}
.mt.on{background:rgba(255,255,255,.1);color:#fff;border-color:var(--b)}
.sp{display:none}.sp.on{display:block}
@media(min-width:900px){.mtb{display:none}.spl{display:grid;grid-template-columns:1fr 1fr;align-items:start}.sp{display:block!important}.card{height:100%}.box{max-width:95%}}
.drop{border:2px dashed var(--b);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:.3s;position:relative;background:rgba(0,0,0,.2);min-height:160px;display:flex;flex-direction:column;justify-content:center;align-items:center}
.drop:hover{border-color:var(--p);background:rgba(0,242,255,.05)}
.drop input{position:absolute;width:100%;height:100%;opacity:0;cursor:pointer;top:0;left:0}
.p-img{width:100%;height:auto;max-height:300px;object-fit:contain;margin-top:10px;border-radius:6px;display:none;border:1px solid var(--b);background:#000}
.p-img.on{display:block}
.as{display:flex;background:rgba(0,0,0,.4);padding:5px;border-radius:8px;margin-bottom:20px}
.ao{flex:1;text-align:center;padding:10px;font-size:.9rem;cursor:pointer;color:var(--ts);border-radius:6px;transition:.3s}
.ao.on{background:var(--s);color:#fff;font-weight:700}

/* --- ç¾åŒ–åçš„æ»‘å— CSS --- */
.sr{display:flex;align-items:center;gap:12px;margin-top:8px;background:rgba(0,0,0,0.2);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.05)}
input[type=range]{-webkit-appearance:none;width:100%;background:transparent;padding:0;margin:0;border:none}
input[type=range]:focus{box-shadow:none}
/* è½¨é“ */
input[type=range]::-webkit-slider-runnable-track{width:100%;height:6px;cursor:pointer;background:linear-gradient(90deg, #1e293b, #334155);border-radius:3px;box-shadow:inset 0 1px 2px rgba(0,0,0,0.5)}
/* æ»‘å— */
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:18px;width:18px;border-radius:50%;background:var(--p);cursor:pointer;margin-top:-6px;box-shadow:0 0 10px rgba(0,242,255,0.5), inset 0 0 0 2px #fff;transition:transform 0.1s}
input[type=range]:active::-webkit-slider-thumb{transform:scale(1.2);background:var(--a);box-shadow:0 0 15px var(--a)}
.vt{background:rgba(0,0,0,0.4);color:var(--p);padding:2px 8px;border-radius:4px;font-size:.8rem;min-width:52px;text-align:center;font-weight:bold;font-family:var(--fm);border:1px solid var(--b)}

#tst{position:fixed;bottom:30px;left:50%;transform:translate(-50%,100px);background:rgba(255,255,255,.95);color:#000;padding:10px 24px;border-radius:30px;font-size:.9rem;opacity:0;transition:.4s;pointer-events:none;font-weight:700;z-index:99}
#tst.on{transform:translate(-50%,0);opacity:1}
.res{background:rgba(0,0,0,.5);border:1px dashed #555;border-radius:6px;padding:10px;margin-top:15px;word-break:break-all;font-family:var(--fm);font-size:.8rem;display:none}
.res.on{display:block;animation:F .3s}
@keyframes F{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="box">
    <h1>CX åŠ å¯†çŸ©é˜µ</h1>
    <div class="nav"><button class="nb on" onclick="SM('txt')">æ–‡æœ¬ä¿¡é“</button><button class="nb" onclick="SM('img')">å›¾ç‰‡åŠ å¯†</button></div>

    <div id="m-txt" class="mod on">
        <details>
            <summary>ğŸ“– ç‚¹å‡»æŸ¥çœ‹ï¼šæ–‡æœ¬åŠ å¯†è¯´æ˜ä¹¦</summary>
            <div class="mc">
                <p><strong>ç¬¬ä¸€æ­¥ (èº«ä»½)ï¼š</strong>è¾“å…¥ä¸€ä¸ªåªæœ‰ä½ çŸ¥é“çš„â€œå£ä»¤â€æ¥ç”Ÿæˆä½ çš„å…¬é’¥ã€‚æŠŠå…¬é’¥å‘ç»™å¯¹æ–¹ã€‚</p>
                <p><strong>(åŠ å¯†)ï¼š</strong>å¡«å…¥å¯¹æ–¹çš„å…¬é’¥ï¼Œè¾“å…¥æ˜æ–‡ï¼Œç‚¹å‡»åŠ å¯†ã€‚å°†ç”Ÿæˆçš„ä¹±ç å‘ç»™å¯¹æ–¹ã€‚</p>
                <p><strong>(è§£å¯†)ï¼š</strong>å¤åˆ¶å¯¹æ–¹å‘æ¥çš„ä¹±ç ï¼Œç‚¹å‡»è§£å¯†å³å¯çœ‹åˆ°å†…å®¹ã€‚</p>
            </div>
        </details>
        <div class="card">
            <div class="ht"><span>èº«ä»½å‡­è¯ (æœ¬ç«¯)</span><span id="led" style="color:#555">â—</span></div>
            <label>åŠ©è®°å¥ (è¾“å…¥å”¯ä¸€å£ä»¤ç”Ÿæˆèº«ä»½)</label>
            <input type="text" id="tp" placeholder="ä¾‹å¦‚ï¼šmy_secret_2026" oninput="TA.rst()">
            <button class="btn" onclick="TA.init()" id="tb">åˆå§‹åŒ–èº«ä»½</button>
            <div id="trp" class="res"><div style="color:var(--p);margin-bottom:5px">æˆ‘çš„å…¬é’¥:</div><div id="tpk" style="color:#fff"></div><button class="cp" onclick="CP('tpk')">å¤åˆ¶å…¬é’¥</button></div>
        </div>
        <div class="mtb"><div class="mt on" onclick="TS('txt','e')" id="mt-txt-e">åŠ å¯†æ¨¡å¼</div><div class="mt" onclick="TS('txt','d')" id="mt-txt-d">è§£å¯†æ¨¡å¼</div></div>
        <div class="spl">
            <div class="card sp on" id="sp-txt-e">
                <div class="ht">ğŸ”’ åŠ å¯†å‘é€</div>
                <label>å¯¹æ–¹å…¬é’¥</label><input type="text" id="trk" placeholder="ç²˜è´´æ¥æ”¶è€…çš„å…¬é’¥">
                <label>æ˜æ–‡å†…å®¹</label><textarea id="tpt" placeholder="è¾“å…¥è¦åŠ å¯†çš„æ¶ˆæ¯..."></textarea>
                <button class="btn" onclick="TA.enc()">æ‰§è¡ŒåŠ å¯†</button>
                <div id="trc" class="res"><div id="tct" style="color:var(--ts)"></div><button class="cp" onclick="CP('tct')">å¤åˆ¶å¯†æ–‡</button></div>
            </div>
            <div class="card sp" id="sp-txt-d">
                <div class="ht">ğŸ”“ è§£å¯†æ¥æ”¶</div>
                <label>å¯†æ–‡æ•°æ®</label><textarea id="tci" placeholder="ç²˜è´´æ”¶åˆ°çš„å¯†æ–‡..."></textarea>
                <button class="btn" onclick="TA.dec()" style="background:linear-gradient(135deg,#059669,#047857)">æ‰§è¡Œè§£å¯†</button>
                <div id="trd" class="res"><div style="color:var(--a);margin-bottom:5px">è§£å¯†ç»“æœ:</div><div id="tdt" style="color:#fff;font-weight:700"></div></div>
            </div>
        </div>
    </div>

    <div id="m-img" class="mod">
        <details>
            <summary>ğŸ“– ç‚¹å‡»æŸ¥çœ‹ï¼šå›¾ç‰‡åŠ å¯†è¯´æ˜ä¹¦</summary>
            <div class="mc">
                <p><span class="tag t1">V1 å¼ºåŠ å¯†</span> å…¨åƒç´ æ‰“ä¹±ï¼Œå®‰å…¨æ€§æé«˜ã€‚<strong>æ³¨æ„ï¼š</strong>ä¸æŠ—å‹ç¼©ï¼Œè‹¥è¢«å‹ç¼©ä¼šé€ æˆä¸¥é‡çš„è‰²å½©ä¸¢å¤±</p>
                <hr style="border-color:var(--b);margin:10px 0">
                <p><span class="tag t2">V2 æŠ—å¹²æ‰°</span> è‰²å—æ··æ·†ï¼Œä¿ç•™éƒ¨åˆ†é¢œè‰²ã€‚<strong>ä¼˜ç‚¹ï¼š</strong>æŠ—å‹ç¼©èƒ½åŠ›å¼ºï¼Œé«˜å‹ç¼©æ¯”ä»ç„¶èƒ½ä¿æŒä¸€å®šè´¨é‡</p>
                <p style="color:var(--p)">* æ”¯æŒç”µè„‘ç«¯ Ctrl+V ç›´æ¥ç²˜è´´å›¾ç‰‡ã€‚</p>
            </div>
        </details>
        <div class="card" style="padding:15px">
            <div class="ht" style="margin-bottom:10px;border:none">é€‰æ‹©ç®—æ³•æ¨¡å¼</div>
            <div class="as"><div class="ao on" onclick="IA.set('v1')" id="b-v1">V1 å¼ºåŠ å¯† (é«˜éšè”½)</div><div class="ao" onclick="IA.set('v2')" id="b-v2">V2 æŠ—å¹²æ‰° (é˜²å‹ç¼©)</div></div>
        </div>
        <div class="mtb"><div class="mt on" onclick="TS('img','e')" id="mt-img-e">åŠ å¯†å›¾ç‰‡</div><div class="mt" onclick="TS('img','d')" id="mt-img-d">è§£å¯†å›¾ç‰‡</div></div>
        <div class="spl">
            <div class="card sp on" id="sp-img-e">
                <div class="ht">ğŸ”’ åŠ å¯†å›¾ç‰‡ (å‘é€)</div>
                <div class="drop" id="dr-e"><input type="file" accept="image/*" onchange="IA.ld(this,'e')"><div style="font-size:2rem">ğŸ“·</div><div id="lb-e">ç‚¹å‡»æˆ–æ‹–æ‹½åŸå›¾<br><span style="font-size:.8rem;color:#888">(æ”¯æŒ Ctrl+V)</span></div><img id="pv-e" class="p-img"></div>
                <label>è®¾ç½®å¯†ç </label><input type="text" id="ke" placeholder="è¾“å…¥åŠ å¯†å¯†ç ï¼ˆæ”¯æŒä¸­è‹±æ–‡æ•°å­—ï¼‰">
                <div id="pa-v1" style="margin-top:15px">
                    <label>è¾“å‡ºè´¨é‡ (V1)</label>
                    <div class="sr"><input type="range" id="qv1" min="10" max="100" value="80" oninput="IA.ui()"><span class="vt" id="vq1">80%</span></div>
                </div>
                <div id="pa-v2" style="margin-top:15px;display:none">
                    <label>å‰ç½®ç¼©æ”¾ (ä¸å»ºè®®è¿‡å°)</label><div class="sr"><input type="range" id="sv2" min="20" max="100" value="100" oninput="IA.ui()"><span class="vt" id="vs2">100%</span></div>
                    <label>åç½®å‹ç¼© (æœ‰æ•ˆé™ä½è¾“å‡ºå¤§å°)</label><div class="sr"><input type="range" id="qv2" min="10" max="100" value="90" oninput="IA.ui()"><span class="vt" id="vq2">90%</span></div>
                </div>
                <button class="btn" onclick="IA.run('e')">ç”ŸæˆåŠ å¯†å›¾</button>
                <div id="rx-e" class="res"><img id="oe" class="p-img on" style="border-color:var(--a)"><div style="text-align:right;font-size:.75rem;margin-top:5px;color:#aaa" id="me"></div><button class="cp" onclick="IA.dl('e')">ğŸ“¥ ä¿å­˜å›¾ç‰‡</button></div>
            </div>
            <div class="card sp" id="sp-img-d">
                <div class="ht">ğŸ”“ è§£å¯†å›¾ç‰‡ (æ¥æ”¶)</div>
                <div class="drop" id="dr-d"><input type="file" accept="image/*" onchange="IA.ld(this,'d')"><div style="font-size:2rem">ğŸ”“</div><div id="lb-d">ç‚¹å‡»æˆ–æ‹–æ‹½ä¹±ç å›¾<br><span style="font-size:.8rem;color:#888">(æ”¯æŒ Ctrl+V)</span></div><img id="pv-d" class="p-img"></div>
                <label>è§£å¯†å¯†ç </label><input type="text" id="kd" placeholder="è¾“å…¥å¯¹åº”å¯†ç ">
                <button class="btn" onclick="IA.run('d')" style="background:linear-gradient(135deg,#059669,#047857)">å¼€å§‹è¿˜åŸ</button>
                <div id="rx-d" class="res"><label style="color:var(--a)">è¿˜åŸç»“æœ:</label><img id="od" class="p-img on" style="border-color:var(--a)"><button class="cp" onclick="IA.dl('d')">ğŸ“¥ ä¿å­˜åŸå›¾</button></div>
            </div>
        </div>
    </div>
</div>
<div id="tst">æç¤º</div><canvas id="cvs" style="display:none"></canvas>
<script>
const $=(i)=>document.getElementById(i);
const T=(m)=>{let t=$('tst');t.innerText=m;t.className='on';clearTimeout(t.tm);t.tm=setTimeout(()=>t.className='',2000)};
const CP=(i)=>{let t=$(i).innerText;if(t)navigator.clipboard.writeText(t).then(()=>T("å·²å¤åˆ¶"))};
function SM(m){document.querySelectorAll('.mod').forEach(e=>e.classList.remove('on'));$('m-'+m).classList.add('on');document.querySelectorAll('.nb').forEach(e=>e.classList.remove('on'));event.target.classList.add('on')}
function TS(m,t){document.querySelectorAll(`#m-${m} .mt`).forEach(e=>e.classList.remove('on'));$(`mt-${m}-${t}`).classList.add('on');document.querySelectorAll(`#m-${m} .sp`).forEach(e=>e.classList.remove('on'));$(`sp-${m}-${t}`).classList.add('on')}
const TA={
    M:{P:2n**255n-19n,i(n){return this.p(n,this.P-2n)},p(b,e){let r=1n;b%=this.P;while(e>0n){if(e%2n===1n)r=(r*b)%this.P;b=(b*b)%this.P;e/=2n}return r},m(s,p){const k=new Uint8Array(s);k[0]&=248;k[31]&=127;k[31]|=64;let n=0n;for(let i=31;i>=0;i--)n=(n<<8n)+BigInt(k[i]);let u=0n;if(p)for(let i=31;i>=0;i--)u=(u<<8n)+BigInt(p[i]);else u=9n;let x1=u,x2=1n,z2=0n,x3=u,z3=1n,sw=0n;for(let t=254;t>=0;t--){const kt=(n>>BigInt(t))&1n;sw^=kt;if(sw){[x2,x3]=[x3,x2];[z2,z3]=[z3,z2]}sw=kt;const A=x2+z2,AA=A*A,B=x2-z2,BB=B*B,E=AA-BB,C=x3+z3,D=x3-z3,DA=D*A,CB=C*B,ad=DA+CB,su=DA-CB;x3=ad*ad;z3=x1*(su*su);x2=AA*BB;z2=E*(AA+486662n*E/4n);x2%=this.P;z2%=this.P;x3%=this.P;z3%=this.P}if(sw){[x2,x3]=[x3,x2];[z2,z3]=[z3,z2]}const r=(x2*this.i(z2))%this.P;const b=new Uint8Array(32);let tp=r;for(let i=0;i<32;i++){b[i]=Number(tp&0xFFn);tp>>=8n}return b}},
    c:{e:new TextEncoder,d:new TextDecoder,pr:null,pk:null,b64(b){return btoa(String.fromCharCode(...new Uint8Array(b))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'')},ub64(s){let b=s.replace(/-/g,'+').replace(/_/g,'/');while(b.length%4)b+='=';return Uint8Array.from(atob(b),c=>c.charCodeAt(0)).buffer},async init(tx){if(!tx)throw"è¯·è¾“å…¥å£ä»¤";const km=await crypto.subtle.importKey("raw",this.e.encode(tx),{name:"PBKDF2"},0,["deriveBits"]);const sd=await crypto.subtle.deriveBits({name:"PBKDF2",salt:this.e.encode("CX3"),iterations:1e5,hash:"SHA-256"},km,256);this.pr=new Uint8Array(sd);this.pk=this.b64(TA.M.m(this.pr,null));return this.pk},async run(k,t,d){if(!this.pr)throw"è¯·å…ˆåˆå§‹åŒ–";const op="AES-GCM";if(d){const j=JSON.parse(this.d.decode(this.ub64(t)));const s=TA.M.m(this.pr,new Uint8Array(this.ub64(j.k)));const ky=await crypto.subtle.importKey("raw",s,op,0,["decrypt"]);return this.d.decode(await crypto.subtle.decrypt({name:op,iv:this.ub64(j.i)},ky,this.ub64(j.c)))}else{const e=crypto.getRandomValues(new Uint8Array(32));const s=TA.M.m(e,new Uint8Array(this.ub64(k)));const ky=await crypto.subtle.importKey("raw",s,op,0,["encrypt"]);const v=crypto.getRandomValues(new Uint8Array(12));const c=await crypto.subtle.encrypt({name:op,iv:v},ky,this.e.encode(t));return this.b64(this.e.encode(JSON.stringify({k:this.b64(TA.M.m(e,null)),i:this.b64(v),c:this.b64(c)})))}}},
    rst(){$('led').style.color='#555';$('tb').disabled=0;$('tb').innerText="åˆå§‹åŒ–èº«ä»½";$('trp').classList.remove('on')},
    async init(){let b=$('tb');b.disabled=1;b.innerText="è®¡ç®—ä¸­...";setTimeout(async()=>{try{$('tpk').innerText=await this.c.init($('tp').value);$('trp').classList.add('on');$('led').style.color='#00ff88';b.innerText="èº«ä»½å·²æ¿€æ´»"}catch(e){alert(e);b.disabled=0;b.innerText="åˆå§‹åŒ–èº«ä»½"}},50)},
    async enc(){try{$('tct').innerText=await this.c.run($('trk').value,$('tpt').value,0);$('trc').classList.add('on')}catch(e){T("é”™è¯¯:"+e)}},
    async dec(){try{$('tdt').innerText=await this.c.run(0,$('tci').value,1);$('trd').classList.add('on')}catch(e){$('tdt').innerText="è§£å¯†å¤±è´¥";$('trd').classList.add('on')}}
};
const IA={
    algo:'v1',fs:{e:null,d:null},
    hash(s){let h1=1779033703,h2=3144134277,h3=1013904242,h4=2773480762;for(let i=0,k;i<s.length;i++){k=s.charCodeAt(i);h1=h2^Math.imul(h1^k,597399067);h2=h3^Math.imul(h2^k,2869860233);h3=h4^Math.imul(h3^k,951274213);h4=h1^Math.imul(h4^k,2716044179)}return h1+h2+h3+h4},
    rng(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}},
    perm(len,seed){const r=this.rng(seed),p=new Uint32Array(len);for(let i=0;i<len;i++)p[i]=i;for(let i=len-1;i>0;i--){const j=Math.floor(r()*(i+1));[p[i],p[j]]=[p[j],p[i]]}return p},
    set(v){this.algo=v;$('b-v1').className=v==='v1'?'ao on':'ao';$('b-v2').className=v==='v2'?'ao on':'ao';$('pa-v1').style.display=v==='v1'?'block':'none';$('pa-v2').style.display=v==='v2'?'block':'none'},
    ui(){$('vq1').innerText=$('qv1').value==100?"PNG":$('qv1').value+"%";$('vs2').innerText=$('sv2').value+"%";$('vq2').innerText=$('qv2').value==100?"PNG":$('qv2').value+"%"},
    ld(i,t){const f=i.files[0];if(!f)return;this.fs[t]=f;const r=new FileReader;r.onload=e=>{$('pv-'+t).src=e.target.result;$('pv-'+t).classList.add('on');$('lb-'+t).style.display='none'};r.readAsDataURL(f)},
    run(t){const f=this.fs[t];if(!f&&!$('pv-'+t).src)return T("è¯·å…ˆè½½å…¥å›¾ç‰‡");const k=$('k'+t).value;if(!k)return T("è¯·è¾“å…¥å¯†ç ");const img=new Image;img.onload=()=>{if(this.algo==='v1')this.pV1(img,k,t);else this.pV2(img,k,t)};img.src=$('pv-'+t).src},
    pV1(img,k,t){
        const c=$('cvs'),x=c.getContext('2d'),w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;c.width=w;c.height=h;x.drawImage(img,0,0);
        const d=x.getImageData(0,0,w,h).data,len=w*h,p=this.perm(len,this.hash(k)),b=new Uint8ClampedArray(d.length),E=t==='e';
        if(E)for(let i=0;i<len;i++){const s=p[i]*4,dst=i*4;b[dst]=d[s];b[dst+1]=d[s+1];b[dst+2]=d[s+2];b[dst+3]=255}
        else for(let i=0;i<len;i++){const s=i*4,dst=p[i]*4;b[dst]=d[s];b[dst+1]=d[s+1];b[dst+2]=d[s+2];b[dst+3]=255}
        x.putImageData(new ImageData(b,w,h),0,0);
        let q=1.0,m='image/png';if(E){const v=parseInt($('qv1').value);if(v<100){m='image/jpeg';q=v/100}}
        this.fin(c,t,m,q);
    },
    pV2(img,k,t){
        const c=$('cvs'),x=c.getContext('2d'),E=t==='e';
        let w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;
        if(E){const s=parseInt($('sv2').value)/100;if(s<1){w=Math.floor(w*s);h=Math.floor(h*s)}}
        w=Math.floor(w/8)*8;h=Math.floor(h/8)*8;if(w<8)w=8;if(h<8)h=8;
        c.width=w;c.height=h;x.drawImage(img,0,0,w,h);
        const d=x.getImageData(0,0,w,h).data,sd=this.hash(k),r=this.rng(sd),bl=w*h/64,p=this.perm(bl,sd),cm=new Int32Array(bl),nr=this.rng(sd+999);
        for(let i=0;i<bl;i++)cm[i]=Math.floor(nr()*1e6);
        const b=new Uint8ClampedArray(d.length),bx=w/8,CM=v=>50+(v/255)*155,EX=v=>{let n=(v-50)/155;if(n<0)n=0;if(n>1)n=1;return n*255};
        for(let i=0;i<bl;i++){
            let si,di;if(E){si=i;di=p[i]}else{si=p[i];di=i}
            const sx=(si%bx)*8,sy=Math.floor(si/bx)*8,dx=(di%bx)*8,dy=Math.floor(di/bx)*8;
            const rw=cm[E?di:si],ns=(rw%81)-40,fU=rw&0x100,fV=rw&0x200,sw=rw&0x400;
            for(let y=0;y<8;y++)for(let l=0;l<8;l++){
                const sI=((sy+y)*w+(sx+l))*4,dI=((dy+y)*w+(dx+l))*4;
                let R=d[sI],G=d[sI+1],B=d[sI+2],Y=.299*R+.587*G+.114*B,U=-.147*R-.289*G+.436*B,V=.615*R-.515*G-.1*B;
                if(E){Y=CM(Y)+ns;if(sw)[U,V]=[V,U];if(fU)U=-U;if(fV)V=-V}
                else{if(fV)V=-V;if(fU)U=-U;if(sw)[U,V]=[V,U];Y-=ns;Y=EX(Y)}
                R=Y+1.14*V;G=Y-.395*U-.581*V;B=Y+2.032*U;
                b[dI]=R;b[dI+1]=G;b[dI+2]=B;b[dI+3]=255;
            }
        }
        x.putImageData(new ImageData(b,w,h),0,0);
        let q=1.0,m='image/png';if(E){const v=parseInt($('qv2').value);if(v<100){m='image/jpeg';q=v/100}}
        this.fin(c,t,m,q);
    },
    fin(c,t,m,q){const u=c.toDataURL(m,q),i=$('o'+t);i.src=u;$('rx-'+t).classList.add('on');i.scrollIntoView({behavior:'smooth',block:'nearest'});if(t==='e'){const s=Math.round((u.length-22)*.75);$('me').innerText=`æ ¼å¼:${m.split('/')[1].toUpperCase()}|å¤§å°:${s>1e6?(s/1e6).toFixed(2)+"MB":(s/1024).toFixed(0)+"KB"}`}},
    dl(t){const s=$('o'+t).src;if(s){const a=document.createElement('a');a.href=s;a.download=`CX_${this.algo}_${Date.now()}.${s.includes('png')?'png':'jpg'}`;a.click()}}
};
document.addEventListener('paste',e=>{if(!$('m-img').classList.contains('on'))return;const it=e.clipboardData.items;let f=null;for(let i=0;i<it.length;i++)if(it[i].type.includes('image')){f=it[i].getAsFile();break}if(!f)return;const hd=$('sp-img-d').matches(':hover'),t=hd?'d':'e',dt=new DataTransfer;dt.items.add(f);$('dr-'+t).querySelector('input').files=dt.files;IA.ld($('dr-'+t).querySelector('input'),t);T(`å·²ç²˜è´´åˆ°${hd?'è§£å¯†':'åŠ å¯†'}æ¡†`)});
['e','d'].forEach(t=>{const d=$('dr-'+t);d.addEventListener('dragover',e=>{e.preventDefault();d.style.borderColor='var(--p)';d.style.background='rgba(0,242,255,.1)'});d.addEventListener('dragleave',e=>{e.preventDefault();d.style.borderColor='var(--b)';d.style.background='rgba(0,0,0,.2)'});d.addEventListener('drop',e=>{e.preventDefault();d.style.borderColor='var(--b)';d.style.background='rgba(0,0,0,.2)';if(e.dataTransfer.files[0]){const i=d.querySelector('input');i.files=e.dataTransfer.files;IA.ld(i,t)}})});
</script>
</body>
</html>
