<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>C-X å®‰å…¨ç»ˆç«¯</title>
<style>
:root{--p:#00f2ff;--s:#0078ff;--a:#00ff88;--e:#ff4757;--bg:#0f172a;--c:rgba(15,23,42,0.85);--b:rgba(255,255,255,0.1);--t:#e2e8f0;--ts:#94a3b8;--fm:'Courier New',monospace;--fu:-apple-system,sans-serif}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{margin:0;padding:15px;background:var(--bg) radial-gradient(circle at 50% 0,rgba(0,242,255,0.1),transparent 40%);color:var(--t);font-family:var(--fu);min-height:100vh;display:flex;flex-direction:column;align-items:center}
body::before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(var(--b) 1px,transparent 1px),linear-gradient(90deg,var(--b) 1px,transparent 1px);background-size:30px 30px;opacity:.08;z-index:-1;pointer-events:none}
.box{width:100%;max-width:1200px;padding-bottom:60px}
h1{text-align:center;font-size:1.4rem;margin:10px 0 20px;background:linear-gradient(90deg,var(--p),var(--s));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;letter-spacing:2px;border-bottom:1px solid var(--b);padding-bottom:15px;text-transform:uppercase}
.nav{display:flex;gap:10px;margin-bottom:20px;justify-content:center}
.nb{background:rgba(0,0,0,.3);color:var(--ts);border:1px solid var(--b);padding:10px 20px;font-size:.95rem;font-weight:600;cursor:pointer;border-radius:6px;transition:.3s;min-width:110px}
.nb.on{background:rgba(0,242,255,.1);color:var(--p);border-color:var(--p);box-shadow:0 0 10px rgba(0,242,255,.15)}
.mod{display:none;animation:F .3s ease}.mod.on{display:block}
.card{background:var(--c);backdrop-filter:blur(16px);border:1px solid var(--b);border-radius:10px;padding:18px;margin-bottom:15px;box-shadow:0 4px 15px rgba(0,0,0,.4)}
.ht{color:var(--p);font-weight:700;font-size:.95rem;margin-bottom:12px;border-bottom:1px solid var(--b);padding-bottom:8px;display:flex;justify-content:space-between;align-items:center}
details{background:rgba(0,0,0,.25);border-radius:6px;border:1px dashed var(--b);margin-bottom:15px;overflow:hidden}
summary{padding:8px 12px;cursor:pointer;color:var(--a);font-weight:700;font-size:.85rem;user-select:none;transition:.2s}
summary:hover{background:rgba(255,255,255,.05)}
.mc{padding:12px;font-size:.8rem;color:var(--ts);line-height:1.6;border-top:1px solid var(--b)}
.mc p{margin:4px 0}.tag{display:inline-block;padding:2px 5px;border-radius:3px;font-size:.7rem;font-weight:700;margin-right:5px}.t1{background:var(--e);color:#fff}.t2{background:var(--s);color:#fff}
label{display:block;font-size:.8rem;color:var(--ts);margin:10px 0 5px}
input[type=text],input[type=password],textarea,select{width:100%;background:rgba(0,0,0,.4);border:1px solid var(--b);border-radius:5px;padding:10px;color:#fff;font-family:var(--fm);font-size:.9rem;outline:0;transition:.3s}
input:focus,textarea:focus,select:focus{border-color:var(--s);box-shadow:0 0 8px rgba(0,120,255,.25)}
textarea{min-height:80px;resize:vertical}
.btn{width:100%;border:none;border-radius:5px;padding:12px;font-weight:600;cursor:pointer;margin-top:15px;background:linear-gradient(135deg,var(--s),#0047ab);color:#fff;letter-spacing:1px;transition:.2s}
.btn:active{transform:scale(.98)}
.cp{background:rgba(0,242,255,.08);color:var(--p);padding:8px;font-size:.8rem;width:100%;margin-top:8px;border:1px solid rgba(0,242,255,.15);cursor:pointer;border-radius:4px;transition:.2s}
.cp:hover{background:rgba(0,242,255,.15)}
.spl{display:flex;flex-direction:column;gap:15px}
.mtb{display:flex;gap:10px;margin-bottom:10px}
.mt{flex:1;padding:8px;text-align:center;background:rgba(0,0,0,.3);border-radius:5px;color:var(--ts);cursor:pointer;border:1px solid transparent;font-size:.9rem}
.mt.on{background:rgba(255,255,255,.08);color:#fff;border-color:var(--b)}
.sp{display:none}.sp.on{display:block}
@media(min-width:900px){.mtb{display:none}.spl{display:grid;grid-template-columns:1fr 1fr;align-items:start}.sp{display:block!important}.card{height:100%}.box{max-width:95%}}
.drop{border:2px dashed var(--b);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:.3s;position:relative;background:rgba(0,0,0,.2);min-height:160px;display:flex;flex-direction:column;justify-content:center;align-items:center}
.drop:hover{border-color:var(--p);background:rgba(0,242,255,.05)}
.drop input{position:absolute;width:100%;height:100%;opacity:0;cursor:pointer;top:0;left:0}
.p-img{width:100%;height:auto;max-height:300px;object-fit:contain;margin-top:10px;border-radius:6px;display:none;border:1px solid var(--b);background:#000}
.p-img.on{display:block}
.as{display:flex;background:rgba(0,0,0,.4);padding:4px;border-radius:6px;margin-bottom:15px}
.ao{flex:1;text-align:center;padding:8px;font-size:.85rem;cursor:pointer;color:var(--ts);border-radius:4px;transition:.3s}
.ao.on{background:var(--s);color:#fff;font-weight:700}
.sr{display:flex;align-items:center;gap:10px;margin-top:8px;background:rgba(0,0,0,.2);padding:6px 10px;border-radius:6px;border:1px solid var(--b)}
input[type=range]{-webkit-appearance:none;width:100%;background:0 0;padding:0;margin:0;border:0}
input[type=range]::-webkit-slider-runnable-track{width:100%;height:4px;cursor:pointer;background:linear-gradient(90deg,#334155,#475569);border-radius:2px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;height:16px;width:16px;border-radius:50%;background:var(--p);cursor:pointer;margin-top:-6px;box-shadow:0 0 10px rgba(0,242,255,.5),inset 0 0 0 2px #fff}
.vt{background:rgba(0,0,0,.4);color:var(--p);padding:2px 6px;border-radius:3px;font-size:.75rem;min-width:48px;text-align:center;font-weight:700;font-family:var(--fm);border:1px solid var(--b)}
#tst{position:fixed;bottom:30px;left:50%;transform:translate(-50%,100px);background:rgba(255,255,255,.95);color:#000;padding:8px 20px;border-radius:30px;font-size:.85rem;opacity:0;transition:.4s;pointer-events:none;font-weight:700;z-index:99}
#tst.on{transform:translate(-50%,0);opacity:1}
.res{background:rgba(0,0,0,.5);border:1px dashed #555;border-radius:6px;padding:10px;margin-top:15px;word-break:break-all;font-family:var(--fm);font-size:.8rem;display:none}.res.on{display:block;animation:F .3s}
.crow{display:flex;align-items:center;background:rgba(0,0,0,.2);margin-bottom:6px;padding:8px;border-radius:5px;border:1px solid var(--b);transition:.2s}
.crow:hover{background:rgba(0,242,255,.05);border-color:var(--p);cursor:pointer}
.cinf{flex:1;overflow:hidden}.cnm{color:var(--p);font-weight:700;font-size:.9rem}.cky{color:var(--ts);font-size:.7rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:var(--fm)}
.cdel{padding:5px 8px;color:var(--e);font-weight:700;cursor:pointer;font-size:1.1rem;margin-left:8px;opacity:.7}.cdel:hover{opacity:1}
.trow{display:flex;gap:8px;margin-bottom:10px}
.tbtn{flex:1;background:rgba(255,255,255,.05);border:1px solid var(--b);color:var(--ts);padding:8px;border-radius:5px;cursor:pointer;font-size:.8rem;transition:.2s}
.tbtn:hover{background:rgba(255,255,255,.1);color:#fff}
.abox{display:flex;gap:8px;margin-bottom:10px}.ainp{flex:1}
#pop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);backdrop-filter:blur(5px);z-index:100;display:none;align-items:center;justify-content:center}
#pop.on{display:flex}
.pbox{background:#1e293b;width:90%;max-width:500px;border-radius:10px;padding:20px;border:1px solid var(--p);box-shadow:0 0 30px rgba(0,242,255,.2)}
@keyframes F{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="box">
    <h1>C-X å®‰å…¨ç»ˆç«¯</h1>
    <div class="nav"><button class="nb on" onclick="SM('txt')">æ–‡æœ¬ä¿¡é“</button><button class="nb" onclick="SM('img')">å›¾ç‰‡åŠ å¯†</button></div>

    <div id="m-txt" class="mod on">
        <div class="card">
            <div class="ht"><span>èº«ä»½å‡­è¯ (IDENTITY)</span><span id="led" style="color:#555">â—</span></div>
            <label>åŠ©è®°å¥ (è¾“å…¥å”¯ä¸€å£ä»¤ç”Ÿæˆèº«ä»½)</label>
            <input type="text" id="tp" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„ä¸“å±å£ä»¤" oninput="TA.rst()">
            <button class="btn" onclick="TA.init()" id="tb">åˆå§‹åŒ–èº«ä»½</button>
            <div id="trp" class="res"><div style="color:var(--p);margin-bottom:5px">æˆ‘çš„å…¬é’¥:</div><div id="tpk" style="color:#fff"></div><button class="cp" onclick="CP('tpk',1)">å¤åˆ¶å…¬é’¥</button></div>
        </div>

        <div class="card">
            <div class="ht" onclick="CM.tog()" style="cursor:pointer"><span>é€šè®¯å½• (CONTACTS)</span><span id="car">â–¼</span></div>
            <div id="cpnl" style="display:none;margin-top:15px">
                <details>
                    <summary>ğŸ“˜ ä½¿ç”¨è¯´æ˜ä¹¦</summary>
                    <div class="mc">
                        <p><strong>æ·»åŠ ï¼š</strong>å¡«å…¥å¤‡æ³¨åå’Œå…¬é’¥ï¼Œç‚¹å‡»æ·»åŠ ã€‚</p>
                        <p><strong>å‘é€ï¼š</strong>ç‚¹å‡»è”ç³»äººï¼Œå…¬é’¥è‡ªåŠ¨å¡«å…¥åŠ å¯†æ¡†ã€‚</p>
                        <p><strong>å¤‡ä»½ï¼š</strong>ç‚¹å‡»â€œå¯¼å‡ºå¤‡ä»½â€ï¼Œç³»ç»Ÿä¼šç”Ÿæˆä¸€ä¸²ä»£ç ï¼Œå¤åˆ¶ä¿å­˜å³å¯ã€‚</p>
                        <p><strong>æ¢å¤ï¼š</strong>ç‚¹å‡»â€œå¯¼å…¥æ¢å¤â€ï¼Œç²˜è´´ä¹‹å‰çš„å¤‡ä»½ä»£ç ã€‚</p>
                    </div>
                </details>
                <div class="trow"><button class="tbtn" onclick="CM.exp()">ğŸ“¤ å¯¼å‡ºå¤‡ä»½</button><button class="tbtn" onclick="CM.imp()">ğŸ“¥ å¯¼å…¥æ¢å¤</button></div>
                <div class="abox"><input type="text" id="can" placeholder="å¤‡æ³¨å" class="ainp" style="flex:0.4"><input type="text" id="cak" placeholder="ç²˜è´´å¯¹æ–¹å…¬é’¥" class="ainp"></div>
                <button class="btn" style="margin:0 0 15px 0;padding:10px;font-size:.9rem" onclick="CM.add()">â• æ·»åŠ è”ç³»äºº</button>
                <div id="clst" style="max-height:200px;overflow-y:auto"></div>
            </div>
        </div>

        <div class="mtb"><div class="mt on" onclick="TS('txt','e')" id="mt-txt-e">åŠ å¯†æ¨¡å¼</div><div class="mt" onclick="TS('txt','d')" id="mt-txt-d">è§£å¯†æ¨¡å¼</div></div>
        <div class="spl">
            <div class="card sp on" id="sp-txt-e">
                <div class="ht">ğŸ”’ åŠ å¯†å‘é€</div>
                <label>æ¥æ”¶æ–¹å…¬é’¥</label><input type="text" id="trk" placeholder="ç²˜è´´å…¬é’¥æˆ–ä»é€šè®¯å½•é€‰æ‹©">
                <label>æ˜æ–‡å†…å®¹</label><textarea id="tpt" placeholder="è¾“å…¥æœºå¯†ä¿¡æ¯..."></textarea>
                <button class="btn" onclick="TA.enc()">æ‰§è¡ŒåŠ å¯†</button>
                <div id="trc" class="res"><div id="tct" style="color:var(--ts)"></div><button class="cp" onclick="CP('tct',1)">å¤åˆ¶å¯†æ–‡</button></div>
            </div>
            <div class="card sp" id="sp-txt-d">
                <div class="ht">ğŸ”“ è§£å¯†æ¥æ”¶</div>
                <label>å¯†æ–‡æ•°æ®</label><textarea id="tci" placeholder="ç²˜è´´æ”¶åˆ°çš„å¯†æ–‡..."></textarea>
                <button class="btn" onclick="TA.dec()" style="background:linear-gradient(135deg,#059669,#047857)">æ‰§è¡Œè§£å¯†</button>
                <div id="trd" class="res"><div style="color:var(--a);margin-bottom:5px">è§£å¯†ç»“æœ:</div><div id="tdt" style="color:#fff;font-weight:700"></div></div>
            </div>
        </div>
    </div>

    <div id="m-img" class="mod">
        <details>
            <summary>ğŸ“– å›¾ç‰‡åŠ å¯†è¯´æ˜ä¹¦</summary>
            <div class="mc">
                <p><span class="tag t1">V1 å¼ºåŠ å¯†</span> å…¨åƒç´ ç½®ä¹±ï¼Œæé«˜å®‰å…¨æ€§ã€‚<strong>æ³¨æ„ï¼š</strong>å¿…é¡»ä»¥â€œæ–‡ä»¶â€å½¢å¼å‘é€åŸå›¾ï¼Œä¸å¯å‹ç¼©ã€‚</p>
                <hr style="border-color:var(--b);margin:8px 0">
                <p><span class="tag t2">V2 æŠ—å¹²æ‰°</span> è‰²å—æ··æ·†æŠ€æœ¯ã€‚<strong>ä¼˜ç‚¹ï¼š</strong>æŠ—å‹ç¼©ï¼Œå¯ç›´æ¥å‘å¾®ä¿¡/QQå›¾ç‰‡ã€‚</p>
                <p style="color:var(--p)">* ç”µè„‘ç«¯æ”¯æŒ Ctrl+V ç›´æ¥ç²˜è´´å›¾ç‰‡ã€‚</p>
            </div>
        </details>
        <div class="card" style="padding:15px">
            <div class="ht" style="margin-bottom:10px;border:none">ç®—æ³•æ¨¡å¼</div>
            <div class="as"><div class="ao on" onclick="IA.set('v1')" id="b-v1">V1 å¼ºåŠ å¯†</div><div class="ao" onclick="IA.set('v2')" id="b-v2">V2 æŠ—å¹²æ‰°</div></div>
        </div>
        <div class="mtb"><div class="mt on" onclick="TS('img','e')" id="mt-img-e">åŠ å¯†å›¾ç‰‡</div><div class="mt" onclick="TS('img','d')" id="mt-img-d">è§£å¯†å›¾ç‰‡</div></div>
        <div class="spl">
            <div class="card sp on" id="sp-img-e">
                <div class="ht">ğŸ”’ åŠ å¯†å›¾ç‰‡</div>
                <div class="drop" id="dr-e"><input type="file" accept="image/*" onchange="IA.ld(this,'e')"><div style="font-size:2rem">ğŸ–¼ï¸</div><div id="lb-e">ç‚¹å‡»æˆ–æ‹–æ‹½åŸå›¾<br><span style="font-size:.8rem;color:#888">(æ”¯æŒ Ctrl+V)</span></div><img id="pv-e" class="p-img"></div>
                <label>è®¾ç½®å¯†ç </label><input type="text" id="ke" placeholder="è¾“å…¥åŠ å¯†å¯†ç ">
                <div id="pa-v1" style="margin-top:15px">
                    <label>è¾“å‡ºè´¨é‡ (V1)</label><div class="sr"><input type="range" id="qv1" min="10" max="100" value="80" oninput="IA.ui()"><span class="vt" id="vq1">80%</span></div>
                </div>
                <div id="pa-v2" style="margin-top:15px;display:none">
                    <label>å‰ç½®ç¼©æ”¾</label><div class="sr"><input type="range" id="sv2" min="20" max="100" value="100" oninput="IA.ui()"><span class="vt" id="vs2">100%</span></div>
                    <label>åç½®å‹ç¼©</label><div class="sr"><input type="range" id="qv2" min="10" max="100" value="90" oninput="IA.ui()"><span class="vt" id="vq2">90%</span></div>
                </div>
                <button class="btn" onclick="IA.run('e')">ç”ŸæˆåŠ å¯†å›¾</button>
                <div id="rx-e" class="res"><img id="oe" class="p-img on" style="border-color:var(--a)"><div style="text-align:right;font-size:.75rem;margin-top:5px;color:#aaa" id="me"></div><button class="cp" onclick="IA.dl('e')">ğŸ“¥ ä¿å­˜å›¾ç‰‡</button></div>
            </div>
            <div class="card sp" id="sp-img-d">
                <div class="ht">ğŸ”“ è§£å¯†å›¾ç‰‡</div>
                <div class="drop" id="dr-d"><input type="file" accept="image/*" onchange="IA.ld(this,'d')"><div style="font-size:2rem">ğŸ”“</div><div id="lb-d">ç‚¹å‡»æˆ–æ‹–æ‹½ä¹±ç å›¾<br><span style="font-size:.8rem;color:#888">(æ”¯æŒ Ctrl+V)</span></div><img id="pv-d" class="p-img"></div>
                <label>è§£å¯†å¯†ç </label><input type="text" id="kd" placeholder="è¾“å…¥å¯¹åº”å¯†ç ">
                <button class="btn" onclick="IA.run('d')" style="background:linear-gradient(135deg,#059669,#047857)">å¼€å§‹è¿˜åŸ</button>
                <div id="rx-d" class="res"><label style="color:var(--a)">è¿˜åŸç»“æœ:</label><img id="od" class="p-img on" style="border-color:var(--a)"><button class="cp" onclick="IA.dl('d')">ğŸ“¥ ä¿å­˜åŸå›¾</button></div>
            </div>
        </div>
    </div>
</div>
<div id="tst"></div><canvas id="cvs" style="display:none"></canvas>
<div id="pop"><div class="pbox"><div class="ht">ğŸ“ æ‰‹åŠ¨å¤åˆ¶æ•°æ®</div><textarea id="ptx" style="height:150px;margin-bottom:10px"></textarea><button class="btn" onclick="$('pop').classList.remove('on')">å…³é—­</button></div></div>
<script>
const $=(i)=>document.getElementById(i);
const T=(m)=>{let t=$('tst');t.innerText=m;t.className='on';clearTimeout(t.tm);t.tm=setTimeout(()=>t.className='',2000)};
const CP=(i,isId)=>{let t=isId?$(i).innerText:i;if(!t)return;navigator.clipboard.writeText(t).then(()=>T("å·²å¤åˆ¶")).catch(()=>{let p=$('pop'),x=$('ptx');x.value=t;p.classList.add('on');x.select();T("è¯·æ‰‹åŠ¨å¤åˆ¶")})};
function SM(m){document.querySelectorAll('.mod').forEach(e=>e.classList.remove('on'));$('m-'+m).classList.add('on');document.querySelectorAll('.nb').forEach(e=>e.classList.remove('on'));event.target.classList.add('on')}
function TS(m,t){document.querySelectorAll(`#m-${m} .mt`).forEach(e=>e.classList.remove('on'));$(`mt-${m}-${t}`).classList.add('on');document.querySelectorAll(`#m-${m} .sp`).forEach(e=>e.classList.remove('on'));$(`sp-${m}-${t}`).classList.add('on')}
const TA={
    M:{P:2n**255n-19n,i(n){return this.p(n,this.P-2n)},p(b,e){let r=1n;b%=this.P;while(e>0n){if(e%2n===1n)r=(r*b)%this.P;b=(b*b)%this.P;e/=2n}return r},m(s,p){const k=new Uint8Array(s);k[0]&=248;k[31]&=127;k[31]|=64;let n=0n;for(let i=31;i>=0;i--)n=(n<<8n)+BigInt(k[i]);let u=0n;if(p)for(let i=31;i>=0;i--)u=(u<<8n)+BigInt(p[i]);else u=9n;let x1=u,x2=1n,z2=0n,x3=u,z3=1n,sw=0n;for(let t=254;t>=0;t--){const kt=(n>>BigInt(t))&1n;sw^=kt;if(sw){[x2,x3]=[x3,x2];[z2,z3]=[z3,z2]}sw=kt;const A=x2+z2,AA=A*A,B=x2-z2,BB=B*B,E=AA-BB,C=x3+z3,D=x3-z3,DA=D*A,CB=C*B,ad=DA+CB,su=DA-CB;x3=ad*ad;z3=x1*(su*su);x2=AA*BB;z2=E*(AA+486662n*E/4n);x2%=this.P;z2%=this.P;x3%=this.P;z3%=this.P}if(sw){[x2,x3]=[x3,x2];[z2,z3]=[z3,z2]}const r=(x2*this.i(z2))%this.P;const b=new Uint8Array(32);let tp=r;for(let i=0;i<32;i++){b[i]=Number(tp&0xFFn);tp>>=8n}return b}},
    c:{e:new TextEncoder,d:new TextDecoder,pr:null,pk:null,b64(b){return btoa(String.fromCharCode(...new Uint8Array(b))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'')},ub64(s){let b=s.replace(/-/g,'+').replace(/_/g,'/');while(b.length%4)b+='=';return Uint8Array.from(atob(b),c=>c.charCodeAt(0)).buffer},async init(tx){if(!tx)throw"è¯·è¾“å…¥å£ä»¤";const km=await crypto.subtle.importKey("raw",this.e.encode(tx),{name:"PBKDF2"},0,["deriveBits"]);const sd=await crypto.subtle.deriveBits({name:"PBKDF2",salt:this.e.encode("CX3"),iterations:1e5,hash:"SHA-256"},km,256);this.pr=new Uint8Array(sd);this.pk=this.b64(TA.M.m(this.pr,null));return this.pk},async run(k,t,d){if(!this.pr)throw"è¯·å…ˆåˆå§‹åŒ–";const op="AES-GCM";if(d){const j=JSON.parse(this.d.decode(this.ub64(t)));const s=TA.M.m(this.pr,new Uint8Array(this.ub64(j.k)));const ky=await crypto.subtle.importKey("raw",s,op,0,["decrypt"]);return this.d.decode(await crypto.subtle.decrypt({name:op,iv:this.ub64(j.i)},ky,this.ub64(j.c)))}else{const e=crypto.getRandomValues(new Uint8Array(32));const s=TA.M.m(e,new Uint8Array(this.ub64(k)));const ky=await crypto.subtle.importKey("raw",s,op,0,["encrypt"]);const v=crypto.getRandomValues(new Uint8Array(12));const c=await crypto.subtle.encrypt({name:op,iv:v},ky,this.e.encode(t));return this.b64(this.e.encode(JSON.stringify({k:this.b64(TA.M.m(e,null)),i:this.b64(v),c:this.b64(c)})))}}},
    rst(){$('led').style.color='#555';$('tb').disabled=0;$('tb').innerText="åˆå§‹åŒ–èº«ä»½";$('trp').classList.remove('on')},
    async init(){let b=$('tb');b.disabled=1;b.innerText="è®¡ç®—ä¸­...";setTimeout(async()=>{try{$('tpk').innerText=await this.c.init($('tp').value);$('trp').classList.add('on');$('led').style.color='#00ff88';b.innerText="èº«ä»½å·²æ¿€æ´»"}catch(e){alert(e);b.disabled=0;b.innerText="åˆå§‹åŒ–èº«ä»½"}},50)},
    async enc(){try{$('tct').innerText=await this.c.run($('trk').value,$('tpt').value,0);$('trc').classList.add('on')}catch(e){T("é”™è¯¯:"+e)}},
    async dec(){try{$('tdt').innerText=await this.c.run(0,$('tci').value,1);$('trd').classList.add('on')}catch(e){$('tdt').innerText="è§£å¯†å¤±è´¥";$('trd').classList.add('on')}}
};
const CM={
    ls:'cx_secure_contacts',l:[],
    init(){try{this.l=JSON.parse(localStorage.getItem(this.ls))||[]}catch{this.l=[]};this.r()},
    tog(){const p=$('cpnl'),a=$('car');if(p.style.display==='none'){p.style.display='block';a.innerText='â–²';if($('trk').value)$('cak').value=$('trk').value}else{p.style.display='none';a.innerText='â–¼'}},
    add(){const n=$('can').value.trim(),k=$('cak').value.trim();if(!n||!k)return T("ä¿¡æ¯ä¸å®Œæ•´");this.l.push({n,k});this.s();$('can').value='';$('cak').value='';T("å·²æ·»åŠ ")},
    del(i){if(confirm("åˆ é™¤æ­¤è”ç³»äºº?")){this.l.splice(i,1);this.s();T("å·²åˆ é™¤")}},
    s(){localStorage.setItem(this.ls,JSON.stringify(this.l));this.r()},
    fill(k){$('trk').value=k;T("å…¬é’¥å·²å¡«å…¥")},
    r(){const c=$('clst');c.innerHTML='';if(!this.l.length){c.innerHTML='<div style="text-align:center;color:#666;font-size:.8rem;padding:10px">ç©º</div>';return}this.l.forEach((m,i)=>{const d=document.createElement('div');d.className='crow';d.innerHTML=`<div class="cinf" onclick="CM.fill('${m.k}')"><div class="cnm">${m.n}</div><div class="cky">${m.k}</div></div><div class="cdel" onclick="CM.del(${i})">Ã—</div>`;c.appendChild(d)})},
    exp(){if(!this.l.length)return T("åˆ—è¡¨ä¸ºç©º");CP(JSON.stringify(this.l),0)},
    imp(){let s=prompt("ç²˜è´´å¤‡ä»½ä»£ç :");if(!s)return;try{let d=JSON.parse(s);if(Array.isArray(d)){if(confirm("è¦†ç›–(OK) è¿˜æ˜¯ åˆå¹¶(Cancel)?"))this.l=d;else d.forEach(n=>{if(!this.l.find(o=>o.k===n.k))this.l.push(n)});this.s();T("å¯¼å…¥æˆåŠŸ")}else throw 1}catch{T("æ•°æ®æ— æ•ˆ")}}
};CM.init();
const IA={
    al:'v1',fs:{e:null,d:null},
    hash(s){let h1=1779033703,h2=3144134277,h3=1013904242,h4=2773480762;for(let i=0,k;i<s.length;i++){k=s.charCodeAt(i);h1=h2^Math.imul(h1^k,597399067);h2=h3^Math.imul(h2^k,2869860233);h3=h4^Math.imul(h3^k,951274213);h4=h1^Math.imul(h4^k,2716044179)}return h1+h2+h3+h4},
    rng(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}},
    perm(len,seed){const r=this.rng(seed),p=new Uint32Array(len);for(let i=0;i<len;i++)p[i]=i;for(let i=len-1;i>0;i--){const j=Math.floor(r()*(i+1));[p[i],p[j]]=[p[j],p[i]]}return p},
    set(v){this.al=v;$('b-v1').className=v==='v1'?'ao on':'ao';$('b-v2').className=v==='v2'?'ao on':'ao';$('pa-v1').style.display=v==='v1'?'block':'none';$('pa-v2').style.display=v==='v2'?'block':'none'},
    ui(){$('vq1').innerText=$('qv1').value==100?"PNG":$('qv1').value+"%";$('vs2').innerText=$('sv2').value+"%";$('vq2').innerText=$('qv2').value==100?"PNG":$('qv2').value+"%"},
    ld(i,t){const f=i.files[0];if(!f)return;this.fs[t]=f;const r=new FileReader;r.onload=e=>{$('pv-'+t).src=e.target.result;$('pv-'+t).classList.add('on');$('lb-'+t).style.display='none'};r.readAsDataURL(f)},
    run(t){const f=this.fs[t];if(!f&&!$('pv-'+t).src)return T("è¯·å…ˆè½½å…¥å›¾ç‰‡");const k=$('ke').value||$('kd').value;if(!k)return T("è¯·è¾“å…¥å¯†ç ");const img=new Image;img.onload=()=>{if(this.al==='v1')this.pV1(img,k,t);else this.pV2(img,k,t)};img.src=$('pv-'+t).src},
    pV1(img,k,t){
        const c=$('cvs'),x=c.getContext('2d'),w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;c.width=w;c.height=h;x.drawImage(img,0,0);
        const d=x.getImageData(0,0,w,h).data,len=w*h,p=this.perm(len,this.hash(k)),b=new Uint8ClampedArray(d.length),E=t==='e';
        if(E)for(let i=0;i<len;i++){const s=p[i]*4,dst=i*4;b[dst]=d[s];b[dst+1]=d[s+1];b[dst+2]=d[s+2];b[dst+3]=255}
        else for(let i=0;i<len;i++){const s=i*4,dst=p[i]*4;b[dst]=d[s];b[dst+1]=d[s+1];b[dst+2]=d[s+2];b[dst+3]=255}
        x.putImageData(new ImageData(b,w,h),0,0);
        let q=1.0,m='image/png';if(E){const v=parseInt($('qv1').value);if(v<100){m='image/jpeg';q=v/100}}this.fin(c,t,m,q);
    },
    pV2(img,k,t){
        const c=$('cvs'),x=c.getContext('2d'),E=t==='e';let w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;
        if(E){const s=parseInt($('sv2').value)/100;if(s<1){w=Math.floor(w*s);h=Math.floor(h*s)}}
        w=Math.floor(w/8)*8;h=Math.floor(h/8)*8;if(w<8)w=8;if(h<8)h=8;
        c.width=w;c.height=h;x.drawImage(img,0,0,w,h);
        const d=x.getImageData(0,0,w,h).data,sd=this.hash(k),r=this.rng(sd),bl=w*h/64,p=this.perm(bl,sd),cm=new Int32Array(bl),nr=this.rng(sd+999);
        for(let i=0;i<bl;i++)cm[i]=Math.floor(nr()*1e6);
        const b=new Uint8ClampedArray(d.length),bx=w/8,CM=v=>50+(v/255)*155,EX=v=>{let n=(v-50)/155;if(n<0)n=0;if(n>1)n=1;return n*255};
        for(let i=0;i<bl;i++){
            let si,di;if(E){si=i;di=p[i]}else{si=p[i];di=i}
            const sx=(si%bx)*8,sy=Math.floor(si/bx)*8,dx=(di%bx)*8,dy=Math.floor(di/bx)*8;
            const rw=cm[E?di:si],ns=(rw%81)-40,fU=rw&0x100,fV=rw&0x200,sw=rw&0x400;
            for(let y=0;y<8;y++)for(let l=0;l<8;l++){
                const sI=((sy+y)*w+(sx+l))*4,dI=((dy+y)*w+(dx+l))*4;
                let R=d[sI],G=d[sI+1],B=d[sI+2],Y=.299*R+.587*G+.114*B,U=-.147*R-.289*G+.436*B,V=.615*R-.515*G-.1*B;
                if(E){Y=CM(Y)+ns;if(sw)[U,V]=[V,U];if(fU)U=-U;if(fV)V=-V}else{if(fV)V=-V;if(fU)U=-U;if(sw)[U,V]=[V,U];Y-=ns;Y=EX(Y)}
                R=Y+1.14*V;G=Y-.395*U-.581*V;B=Y+2.032*U;b[dI]=R;b[dI+1]=G;b[dI+2]=B;b[dI+3]=255;
            }
        }
        x.putImageData(new ImageData(b,w,h),0,0);
        let q=1.0,m='image/png';if(E){const v=parseInt($('qv2').value);if(v<100){m='image/jpeg';q=v/100}}this.fin(c,t,m,q);
    },
    fin(c,t,m,q){const u=c.toDataURL(m,q),i=$('o'+t);i.src=u;$('rx-'+t).classList.add('on');i.scrollIntoView({behavior:'smooth',block:'nearest'});if(t==='e'){const s=Math.round((u.length-22)*.75);$('me').innerText=`æ ¼å¼:${m.split('/')[1].toUpperCase()}|å¤§å°:${s>1e6?(s/1e6).toFixed(2)+"MB":(s/1024).toFixed(0)+"KB"}`}},
    dl(t){const s=$('o'+t).src;if(s){const a=document.createElement('a');a.href=s;a.download=`CX_${this.al}_${Date.now()}.${s.includes('png')?'png':'jpg'}`;a.click()}}
};
document.addEventListener('paste',e=>{if(!$('m-img').classList.contains('on'))return;const it=e.clipboardData.items;let f=null;for(let i=0;i<it.length;i++)if(it[i].type.includes('image')){f=it[i].getAsFile();break}if(!f)return;const hd=$('sp-img-d').matches(':hover'),t=hd?'d':'e',dt=new DataTransfer;dt.items.add(f);$('dr-'+t).querySelector('input').files=dt.files;IA.ld($('dr-'+t).querySelector('input'),t);T(`å·²ç²˜è´´åˆ°${hd?'è§£å¯†':'åŠ å¯†'}æ¡†`)});
['e','d'].forEach(t=>{const d=$('dr-'+t);d.addEventListener('dragover',e=>{e.preventDefault();d.style.borderColor='var(--p)';d.style.background='rgba(0,242,255,.1)'});d.addEventListener('dragleave',e=>{e.preventDefault();d.style.borderColor='var(--b)';d.style.background='rgba(0,0,0,.2)'});d.addEventListener('drop',e=>{e.preventDefault();d.style.borderColor='var(--b)';d.style.background='rgba(0,0,0,.2)';if(e.dataTransfer.files[0]){const i=d.querySelector('input');i.files=e.dataTransfer.files;IA.ld(i,t)}})});
</script>
</body>
</html>
